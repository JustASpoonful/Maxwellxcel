<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MXCEL OS 2</title>
  <link rel="icon" type="image/x-icon" href="Win7Xcel.png">
  <style>
    /* ----- BASE STYLES ----- */
    body {
      margin: 0;
      padding: 0;
      background: url('https://platform.theverge.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/22661975/img24.jpg?quality=90&strip=all') no-repeat center center fixed;
      background-size: cover;
      font-family: "Segoe UI", sans-serif;
      overflow: hidden;
    }

    /* ----- GLASSMORPHISM MIXIN ----- */
    .glass {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }

    /* ----- SETUP PAGE ----- */
    .setup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100000;
      background: rgba(0, 0, 0, 0.5);
    }
    .setup-panel {
      width: 300px;
      padding: 20px;
      text-align: center;
    }
    .setup-panel h2 {
      margin-bottom: 10px;
      color: #fff;
    }
    .setup-panel button {
      margin-top: 15px;
      padding: 8px 16px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      font-size: 14px;
    }

    /* ----- TASKBAR ----- */
    .taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40px;
      display: flex;
      align-items: center;
      padding: 0 10px;
      box-shadow: 0px -3px 5px rgba(0, 0, 0, 0.5);
      background: rgba(20, 20, 20, 0.4);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .taskbar img {
      width: 30px;
      height: 30px;
      cursor: pointer;
      margin-right: 10px;
      /* slight glass behind icons */
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      border-radius: 4px;
      padding: 4px;
    }

    /* ----- DESKTOP ICONS ----- */
    .desktop {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      flex-direction: column;
      flex-wrap: wrap;
      gap: 10px;
      height: calc(100% - 40px);
    }
    .icon {
      text-align: center;
      cursor: pointer;
      color: white;
      width: 80px;
    }
    .icon img {
      width: 50px;
      height: 50px;
    }

    /* ----- WINDOWS ----- */
    .window {
      position: absolute;
      width: 800px;
      height: 600px;
      display: none;
      top: 100px;
      left: 100px;
      /* improved glass effect */
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    .window .title-bar {
      /* glass tab */
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: #0078D7;
      padding: 5px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }
    .window .title-bar button {
      background: red;
      color: white;
      border: none;
      cursor: pointer;
      width: 20px;
      height: 20px;
      font-weight: bold;
      line-height: 18px;
      text-align: center;
      padding: 0;
      margin-left: 5px;
      border-radius: 2px;
    }
    .window .content {
      padding: 10px;
      height: calc(100% - 30px);
      overflow: auto;
    }
    .resize-handle {
      width: 10px;
      height: 10px;
      background: gray;
      position: absolute;
      bottom: 0;
      right: 0;
      cursor: nwse-resize;
    }

    /* ----- CUSTOM CONTEXT MENU ----- */
    #custom-context-menu {
      position: absolute;
      display: none;
      z-index: 10000;
      padding: 5px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 4px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }
    #custom-context-menu div {
      cursor: pointer;
      padding: 3px 10px;
      border-radius: 2px;
    }
    #custom-context-menu div:hover {
      background: rgba(255,255,255,0.3);
    }

    /* ----- APP STORE CARDS ----- */
    #app-store-list > div {
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <!-- SETUP PAGE -->
  <div class="setup-overlay" id="setup">
    <div class="setup-panel glass">
      <h2>Welcome to MXCEL OS 6</h2>
      <p>Letâ€™s get you started!</p>
      <button onclick="completeSetup()">Begin</button>
    </div>
  </div>

  <!-- DESKTOP AREA -->
  <div class="desktop"></div>

  <!-- TASKBAR -->
  <div class="taskbar">
    <img src="https://img.icons8.com/ios_filled/512/FA5252/windows-10.png" alt="Start Menu" onclick="alert('Start Menu not implemented yet!')" />
  </div>
  
  <!-- CUSTOM CONTEXT MENU -->
  <div id="custom-context-menu">
    <div id="delete-option">Delete</div>
  </div>

  <!-- APPS LIST -->
  <script src="apps.js"></script>

  <script>
    // SETUP LOGIC
    function completeSetup() {
      localStorage.setItem('setupDone', 'true');
      document.getElementById('setup').style.display = 'none';
    }
    window.addEventListener('load', () => {
      if (localStorage.getItem('setupDone') === 'true') {
        document.getElementById('setup').style.display = 'none';
      }
    });

    // EXISTING LOGIC
    function loadInstalledApps() {
      const saved = localStorage.getItem('installedApps');
      if (saved) {
        const installedApps = JSON.parse(saved);
        appList.forEach(app => {
          if (installedApps.hasOwnProperty(app.name)) app.installed = installedApps[app.name];
        });
      }
    }
    function saveInstalledApps() {
      const data = {};
      appList.forEach(app => data[app.name] = app.installed);
      localStorage.setItem('installedApps', JSON.stringify(data));
    }
    function renderDesktopIcons() {
      const d = document.querySelector('.desktop'); d.innerHTML = '';
      appList.filter(a => a.installed).forEach(app => {
        const div = document.createElement('div'); div.classList.add('icon');
        div.ondblclick = () => openApp(app.name.toLowerCase());
        div.addEventListener('contextmenu', e => { e.preventDefault(); if (!app.preinstalled) showContextMenu(e.pageX, e.pageY, app); });
        const img = document.createElement('img'); img.src = app.icon; img.alt = app.name;
        const label = document.createElement('div'); label.textContent = app.name;
        div.append(img, label); d.append(div);
      });
    }
    function renderTaskbarIcons() {
      const t = document.querySelector('.taskbar'); while (t.children.length > 1) t.removeChild(t.lastChild);
      appList.filter(a => a.installed).forEach(app => {
        const img = document.createElement('img'); img.src = app.icon; img.alt = app.name; img.title = app.name;
        img.ondblclick = () => openApp(app.name.toLowerCase());
        img.addEventListener('contextmenu', e => { e.preventDefault(); if (!app.preinstalled) showContextMenu(e.pageX, e.pageY, app); });
        t.append(img);
      });
    }
    function openApp(id) {
      const app = appList.find(a => a.name.toLowerCase() === id);
      if (!app) return;
      let w = document.getElementById(id);
      if (!w) w = createAppWindow(app);
      else { w.style.display = 'block'; if (app.name.toLowerCase()==='app store') renderAppStoreList(); }
    }
    function createAppWindow(app) {
      const w = document.createElement('div'); w.classList.add('window'); w.id = app.name.toLowerCase(); w.style.display='block';
      const bar = document.createElement('div'); bar.classList.add('title-bar'); bar.textContent = app.name;
      const btn = document.createElement('button'); btn.textContent='X'; btn.onclick=() => w.style.display='none'; bar.append(btn);
      const c = document.createElement('div'); c.classList.add('content');
      if (app.name.toLowerCase()==='settings') c.innerHTML = `<h3>Change Background</h3><input type="text" id="bg-url" placeholder="Enter image URL"><button onclick="changeBackground()">Apply</button>`;
      else if (app.name.toLowerCase()==='app store') { c.innerHTML=`<h3>App Store</h3><div id="app-store-list"></div>`; setTimeout(renderAppStoreList,0); }
      else { const ifr=document.createElement('iframe'); ifr.src=app.content; ifr.style.width='100%'; ifr.style.height='100%'; ifr.style.border='none'; c.append(ifr); }
      const rh = document.createElement('div'); rh.classList.add('resize-handle');
      w.append(bar, c, rh); document.body.append(w);
      makeDraggableAndResizable(w);
      return w;
    }
    function makeDraggableAndResizable(w) {
      let d=false, r=false, sx, sy, sw, sh, ox, oy;
      const bar=w.querySelector('.title-bar'), rh=w.querySelector('.resize-handle');
      bar.onmousedown=e=>{ d=true; ox=e.clientX-w.offsetLeft; oy=e.clientY-w.offsetTop; };
      rh.onmousedown=e=>{ r=true; sx=e.clientX; sy=e.clientY; sw=w.offsetWidth; sh=w.offsetHeight; e.stopPropagation(); };
      document.addEventListener('mousemove', e=>{ if(d){ w.style.left=(e.clientX-ox)+'px'; w.style.top=(e.clientY-oy)+'px'; } if(r){ w.style.width=sw+(e.clientX-sx)+'px'; w.style.height=sh+(e.clientY-sy)+'px'; }});
      document.addEventListener('mouseup', ()=>{ d=r=false; });
    }
    function changeBackground() { const u=document.getElementById('bg-url').value; if(u){ localStorage.setItem('wallpaper',u); document.body.style.backgroundImage=`url('${u}')`; }}
    function renderAppStoreList() {
      const l=document.getElementById('app-store-list'); if(!l) return; l.innerHTML='';
      const avail=appList.filter(a=>!a.installed && a.name.toLowerCase()!=='app store');
      if(avail.length===0) return l.innerHTML='<p>All apps are installed.</p>';
      avail.forEach(app=>{
        const card=document.createElement('div');
        const row=document.createElement('div'); row.style.display='flex'; row.style.alignItems='center';
        const img=document.createElement('img'); img.src=app.icon; img.style.width='40px'; img.style.height='40px'; img.style.marginRight='10px';
        const name=document.createElement('span'); name.textContent=app.name; name.style.fontWeight='bold';
        row.append(img,name);
        const desc=document.createElement('div'); desc.textContent=app.description; desc.style.fontSize='12px'; desc.style.color='#555'; desc.style.marginTop='5px';
        const btn=document.createElement('button'); btn.textContent='Install'; btn.style.marginTop='10px'; btn.onclick=()=>{ app.installed=true; saveInstalledApps(); renderDesktopIcons(); renderTaskbarIcons(); renderAppStoreList(); };
        card.append(row, desc, btn); l.append(card);
      });
    }
    let currentApp=null;
    function showContextMenu(x,y,app){ currentApp=app; const m=document.getElementById('custom-context-menu'); m.style.left=x+'px'; m.style.top=y+'px'; m.style.display='block'; }
    function hideContextMenu(){ const m=document.getElementById('custom-context-menu'); m.style.display='none'; currentApp=null; }
    document.getElementById('delete-option').addEventListener('click', ()=>{ if(currentApp && !currentApp.preinstalled){ currentApp.installed=false; saveInstalledApps(); renderDesktopIcons(); renderTaskbarIcons(); renderAppStoreList(); } hideContextMenu(); });
    document.getElementById('custom-context-menu').addEventListener('click', e=>e.stopPropagation());
    document.addEventListener('click', hideContextMenu);
    window.onload = () => {
      loadInstalledApps();
      renderDesktopIcons();
      renderTaskbarIcons();
      const s = localStorage.getItem('wallpaper');
      if (s) document.body.style.backgroundImage = `url('${s}')`;
    };
  </script>

</body>
</html>
